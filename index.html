<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ponte en mis Zapatos: El Reto Diario</title>
    <link rel="icon" href="imgs/sena_verde.webp" type="image/png" sizes="32x32">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Work+Sans:wght@500&display=swap" rel="stylesheet">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        :root {
            --color-primario: #00BFFF;
            --color-secundario: #F8C548;
            --color-texto: #EAEAEA;
            --color-sombra: rgba(0, 0, 0, 0.5);
            --color-fondo-boton: #1B2735;
            --btn-radius: 14px;
        }

        body {
            color: var(--color-texto);
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 40px 20px;
            box-sizing: border-box;
            perspective: 500px;
            overflow-x: hidden;
            overflow-y: auto;
            /* === FONDO MEJORADO CON GRADIENTES RADIALES === */
            background:
                radial-gradient(circle at 25% 30%, #1c3142 0%, #090A0F 70%),
                radial-gradient(circle at 75% 70%, #152632 0%, #090A0F 65%);
            background-attachment: fixed;
            position: relative;
        }

        /* --- ANIMACI√ìN DE FONDO: PART√çCULAS FLOTANTES --- */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, var(--color-primario), transparent),
                radial-gradient(2px 2px at 40px 70px, var(--color-secundario), transparent),
                radial-gradient(1px 1px at 90px 40px, var(--color-primario), transparent),
                radial-gradient(1px 1px at 130px 80px, var(--color-secundario), transparent),
                radial-gradient(2px 2px at 160px 30px, var(--color-primario), transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: floatingParticles 20s linear infinite;
            opacity: 0.3;
            z-index: 0;
            pointer-events: none;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(1px 1px at 50px 50px, rgba(255, 255, 255, 0.5), transparent),
                radial-gradient(1px 1px at 100px 100px, rgba(255, 255, 255, 0.3), transparent),
                radial-gradient(2px 2px at 150px 150px, rgba(255, 255, 255, 0.2), transparent);
            background-repeat: repeat;
            background-size: 300px 300px;
            animation: floatingParticles 30s linear infinite reverse;
            opacity: 0.4;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes floatingParticles {
            0% {
                transform: translateY(0px) translateX(0px);
            }
            33% {
                transform: translateY(-100px) translateX(50px);
            }
            66% {
                transform: translateY(-200px) translateX(-30px);
            }
            100% {
                transform: translateY(-300px) translateX(0px);
            }
        }

        .dynamic-background {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            opacity: .35;
            pointer-events: none;
        }
        #home-anim { width: 100%; height: 100%; object-fit: cover; }
        #home { clip-path: url(#cache); }

        /* === L√çNEAS ANIMADAS SVG (como Mitos y Realidades) === */
        #light-blue {
            stroke: var(--color-primario);
            stroke-width: 3;
            stroke-dasharray: 160;
            stroke-dashoffset: 500;
            animation: lineFlow 14s linear infinite, moveBlue 25s ease-in-out infinite;
            fill: none;
            transform-origin: center;
        }

        #light-yellow {
            stroke: var(--color-secundario);
            stroke-width: 2;
            stroke-dasharray: 120;
            stroke-dashoffset: 400;
            animation: lineFlow 18s linear infinite reverse, moveYellow 30s ease-in-out infinite;
            fill: none;
            transform-origin: center;
        }

        #light-green {
            stroke: var(--color-primario);
            stroke-width: 2;
            stroke-dasharray: 100;
            stroke-dashoffset: 350;
            animation: lineFlow 22s linear infinite, moveGreen 35s ease-in-out infinite;
            fill: none;
            transform-origin: center;
        }

        @keyframes lineFlow {
            0% { stroke-dashoffset: 500; }
            100% { stroke-dashoffset: 0; }
        }

        /* Movimiento de la l√≠nea azul */
        @keyframes moveBlue {
            0%, 100% { 
                transform: translateX(0px) translateY(0px) rotate(0deg); 
            }
            25% { 
                transform: translateX(50px) translateY(-30px) rotate(2deg); 
            }
            50% { 
                transform: translateX(-20px) translateY(40px) rotate(-1deg); 
            }
            75% { 
                transform: translateX(30px) translateY(-20px) rotate(1deg); 
            }
        }

        /* Movimiento de la l√≠nea amarilla */
        @keyframes moveYellow {
            0%, 100% { 
                transform: translateX(0px) translateY(0px) rotate(0deg); 
            }
            20% { 
                transform: translateX(-40px) translateY(25px) rotate(-1deg); 
            }
            40% { 
                transform: translateX(35px) translateY(-35px) rotate(2deg); 
            }
            60% { 
                transform: translateX(-25px) translateY(45px) rotate(-1deg); 
            }
            80% { 
                transform: translateX(45px) translateY(-15px) rotate(1deg); 
            }
        }

        /* Movimiento de la l√≠nea verde */
        @keyframes moveGreen {
            0%, 100% { 
                transform: translateX(0px) translateY(0px) rotate(0deg); 
            }
            33% { 
                transform: translateX(-35px) translateY(-40px) rotate(-2deg); 
            }
            66% { 
                transform: translateX(40px) translateY(35px) rotate(1deg); 
            }
        }

        /* Movimiento de l√≠neas sutiles */
        @keyframes moveSubtle1 {
            0%, 100% { 
                transform: translateX(0px) translateY(0px); 
            }
            50% { 
                transform: translateX(-60px) translateY(20px); 
            }
        }

        @keyframes moveSubtle2 {
            0%, 100% { 
                transform: translateX(0px) translateY(0px); 
            }
            50% { 
                transform: translateX(60px) translateY(-25px); 
            }
        }

        .main-container {
            background: rgba(27, 39, 53, 0.50);
            backdrop-filter: blur(12px) saturate(140%);
            -webkit-backdrop-filter: blur(12px) saturate(140%);
            border: 1px solid rgba(255, 255, 255, 0.16);
            padding: 2rem;
            border-radius: 22px;
            box-shadow: 
                0 10px 30px -6px var(--color-sombra), 
                0 0 0 1px #ffffff12 inset,
                0 0 50px -10px rgba(0, 191, 255, 0.1);
            width: 100%;
            max-width: 800px;
            text-align: center;
            position: relative; 
            z-index: 2;
            overflow: hidden;
        }
        
        .main-container::before {
            content:"";
            position:absolute;
            inset:0;
            background:
              linear-gradient(120deg,#00bfff11,transparent 60%),
              linear-gradient(-40deg,#f8c54811,transparent 65%);
            mix-blend-mode:overlay;
            pointer-events:none;
            border-radius: inherit;
        }

        /* Efecto glassmorphism animado adicional */
        .main-container::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                rgba(0, 191, 255, 0.05),
                rgba(248, 197, 72, 0.05),
                rgba(0, 191, 255, 0.08),
                rgba(248, 197, 72, 0.08),
                rgba(0, 191, 255, 0.05)
            );
            background-size: 400% 400%;
            animation: gradientMove 8s ease-in-out infinite;
            z-index: -1;
            border-radius: 22px;
            pointer-events: none;
        }

        @keyframes gradientMove {
            0%, 100% {
                background-position: 0% 50%;
            }
            25% {
                background-position: 100% 50%;
            }
            50% {
                background-position: 100% 100%;
            }
            75% {
                background-position: 0% 100%;
            }
        }

        #character-selection-container h1,
        #scene-title {
            color: var(--color-secundario);
            font-size: 2.5em;
            margin: 0 0 .5rem;
            letter-spacing: .5px;
            text-shadow:
              0 0 6px #f8c54855,
              0 0 16px #f8c54833,
              0 0 36px #00bfff22;
        }
        #character-selection-container h2.subtitle {
            color: var(--color-secundario);
            font-size: 2em;
            margin-bottom: 1.5rem;
            font-family: 'Work Sans', sans-serif;
        }
        #character-selection-container p {
            font-size: 1.15em;
            line-height: 1.65;
            margin: 1rem 0 1.2rem;
        }

        #character-buttons { 
            display: flex; 
            flex-direction: column; 
            gap: 1rem; 
            margin-top: 2rem; 
            align-items: center;
        }

        #story-text {
            font-size: 1.1em;
            line-height: 1.65;
            min-height: 110px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #choices-container {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            align-items: center;
        }

        /* Botones: mejorar legibilidad al hover y enfoque */
        .choice-button { 
            position: relative;
            padding: .95em 2.3em;
            cursor: pointer;
            background: #162430;
            border: 2px solid #1e3847;
            border-radius: var(--btn-radius);
            text-transform: uppercase;
            font-size: 1.05em;
            font-family: "Work Sans", sans-serif;
            font-weight: 600;
            letter-spacing: 0.05em;
            color: #e6f7ff;
            width: 80%;
            max-width: 480px;
            overflow: hidden;
            transition: background .45s, color .45s, box-shadow .45s, transform .35s;
        }
        .choice-button span { display: inline-block; }
        .choice-button::before {
            content:"";
            position:absolute;
            inset:0;
            background:
              radial-gradient(circle at 20% 120%, #00bfff33, transparent 60%),
              radial-gradient(circle at 85% -10%, #f8c54833, transparent 60%);
            opacity:0;
            mix-blend-mode: screen;
            transition: opacity .6s;
        }
        .choice-button:hover,
        .choice-button:focus-visible {
            background: linear-gradient(135deg,#00bfff 0%, #f8c548 100%);
            color:#12202a;
            box-shadow:
              0 0 8px -2px #00bfff,
              0 0 18px -4px #f8c548,
              0 0 34px -6px #00bfff55;
        }
        .choice-button:hover::before,
        .choice-button:focus-visible::before {
            opacity:.85;
        }
        .choice-button:active {
            transform: scale(.97);
        }
        .choice-button:focus-visible {
            outline: 3px solid #ffffffaa;
            outline-offset: 3px;
        }

        /* Sombra clara detr√°s del texto para que nunca ‚Äúdesaparezca‚Äù sobre fondos variables */
        .choice-button span {
            text-shadow: 0 1px 2px #00000055;
        }
        .choice-button:hover span,
        .choice-button:focus-visible span {
            text-shadow: 0 1px 2px #ffffff77;
            font-weight: 700;
        }

        /* Efecto ‚Äúonda‚Äù (ripple) liviano */
        .choice-button .ripple {
            position:absolute;
            width:14px;
            height:14px;
            background: radial-gradient(circle, #ffffffcc 0%, #ffffff55 45%, transparent 70%);
            border-radius:50%;
            transform: scale(0);
            animation: ripple .65s ease-out forwards;
            pointer-events: none;
            mix-blend-mode: plus-lighter;
        }
        @keyframes ripple {
            to { transform: scale(22); opacity:0; }
        }

        #reflection-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9em; }
        #reflection-table th, #reflection-table td { border: 2px solid var(--color-primario); padding: 12px; text-align: left; vertical-align: top; }
        #reflection-table th { background-color: var(--color-primario); color: #ffffff; font-size: 1.05em; }
        .ponte-en-tus-zapatos { background-color: rgba(27, 39, 53, 0.7); font-style: italic; }
        #reflection-table td strong { color: var(--color-secundario); }

        .image-block {
            width: 100%;
            height: 450px;
            border-radius: 18px;
            position: relative;
            margin-bottom: 1.6rem;
            transition: box-shadow .6s, transform 1.2s cubic-bezier(.19,1,.22,1);
            background:#050b10;
            overflow: visible; /* Cambiado para que se vea el efecto resplandeciente */
        }

        /* Efecto de borde resplandeciente sutil para el contenedor de im√°genes (de Mitos y Realidades) */
        .image-block::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(
                90deg,
                var(--color-primario),
                var(--color-secundario),
                var(--color-primario)
            );
            background-size: 200% 100%;
            border-radius: 18px; /* Ajustado para coincidir exactamente con .image-block */
            z-index: -1;
            opacity: 0.8;
            animation: subtleGlow 3s ease-in-out infinite;
        }

        @keyframes subtleGlow {
            0%, 100% {
                background-position: 0% 50%;
                opacity: 0.6;
            }
            50% {
                background-position: 100% 50%;
                opacity: 1;
            }
        }

        .image-block:hover {
            box-shadow: 0 0 50px -10px #0d2733, 0 0 0 1px #00bfff55 inset;
        }
        .image-block .circleLight {
            position:absolute;
            inset:0;
            opacity:0;
            background: radial-gradient(circle at 50% 50%, #ffffffaa 0%, transparent 55%);
            mix-blend-mode: overlay;
            transition: opacity .55s;
            border-radius: inherit;
        }
        .image-block:hover .circleLight {
            opacity:.22;
        }

        /* Eliminamos glitch pesado: dejamos un contenedor plano */
        .c-glitch {
            position:relative;
            width:100%;
            height:100%;
            background:#000 center/cover no-repeat;
            filter: grayscale(.3) contrast(1.05) brightness(.94);
            transition: filter 1s ease, transform 1.4s cubic-bezier(.19,1,.22,1);
            border-radius: 18px; /* A√±adido para que coincida con el contenedor padre */
        }
        .image-block:hover .c-glitch {
            filter: grayscale(0) contrast(1.15) brightness(1.05) saturate(1.18);
            transform: scale(1.055);
        }
        /* Eliminados .c-glitch__img y keyframes glitch originales */

        .hidden { display: none !important; }

        #preloader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 9999;
            background: #090A0F;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease-out;
        }
        .spinner {
            width: 54px;
            height: 54px;
            border: 6px solid rgba(0, 191, 255, 0.25);
            border-top-color: var(--color-secundario);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            box-shadow: 0 0 12px -2px #00bfffaa, 0 0 22px -4px #f8c548aa;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        body.loading > *:not(#preloader) { display: none; }

        /* Logo SENA en la esquina superior izquierda */
        #sena-logo {
            position: fixed;
            top: 20px;
            left: 20px; /* Cambiado de right a left */
            width: 60px;
            height: 60px;
            z-index: 100;
            opacity: 0.9;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        #sena-logo:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        #sena-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.3));
        }

        /* --- Bot√≥n de control de m√∫sica --- */
        #music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 12px;
            background-color: rgba(27, 39, 53, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            z-index: 100;
            font-family: "Work Sans", sans-serif;
            font-size: 0.8em;
            color: #e6f7ff;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        #music-control:hover {
            background-color: rgba(0, 191, 255, 0.8);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.4);
        }

        #music-text {
            white-space: nowrap;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            body { padding: 22px 12px; }
            .main-container { padding: 1.1rem 1rem 1.9rem; }
            .image-block { height: 250px; }
            #scene-title, #character-selection-container h1 { font-size: 1.55em; }
            #story-text, #character-selection-container p { font-size: 1em; }
            .choice-button { font-size: 0.95em; width: 100%; }
            #reflection-table { font-size: 0.78em; }
            #music-control { 
                top: 10px; 
                right: 10px; 
                font-size: 0.7em;
                padding: 6px 8px;
            }
            
            /* Ajustar logo SENA en m√≥viles */
            #sena-logo {
                top: 10px;
                left: 10px; /* Cambiado de right a left */
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body class="loading">
    <div id="preloader">
        <div class="spinner"></div>
    </div>

    <!-- Logo SENA en la esquina superior derecha -->
    <div id="sena-logo">
        <img src="imgs/sena_blanco.webp" alt="Logo SENA">
    </div>

    <!-- Bot√≥n de control de m√∫sica -->
    <div id="music-control" title="Control de M√∫sica">
        <span id="music-text">üîá Encender M√∫sica</span>
    </div>

    <!-- SVG con l√≠neas animadas de fondo (igual que Mitos y Realidades) -->
    <svg id="animated-lines" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; opacity: 0.6;">
        <!-- L√≠nea azul principal -->
        <path id="light-blue" d="M0,400 Q300,200 600,400 T1200,300" />
        
        <!-- L√≠nea amarilla secundaria -->
        <path id="light-yellow" d="M0,600 Q400,300 800,500 T1200,400" />
        
        <!-- L√≠nea verde terciaria -->
        <path id="light-green" d="M0,200 Q200,500 500,300 Q800,100 1200,600" />
        
        <!-- L√≠neas adicionales m√°s sutiles -->
        <path stroke="rgba(255,255,255,0.1)" stroke-width="1" fill="none" 
              d="M0,100 Q600,50 1200,100" 
              stroke-dasharray="50" stroke-dashoffset="200"
              style="animation: lineFlow 25s linear infinite, moveSubtle1 40s ease-in-out infinite;" />
        
        <path stroke="rgba(255,255,255,0.1)" stroke-width="1" fill="none" 
              d="M0,700 Q300,650 600,700 Q900,750 1200,700" 
              stroke-dasharray="40" stroke-dashoffset="150"
              style="animation: lineFlow 30s linear infinite reverse, moveSubtle2 45s ease-in-out infinite;" />
    </svg>
    
    <div id="character-selection-container" class="main-container">
        <div class="image-block" id="selection-image-block">
            <span class="circleLight"></span>
            <!-- Contenedor simplificado sin glitch pesado -->
            <div class="c-glitch" id="selection-glitch-container"></div>
        </div>
        <h1>Ponte en mis zapatos:</h1>
        <h2 class="subtitle">El Reto Diario</h2>
        <p>Est√°s a punto de iniciar una simulaci√≥n. Aqu√≠ no hay puntos ni ganadores. El objetivo es experimentar, por un momento, los desaf√≠os diarios que enfrentan las personas con discapacidad.</p>
        <div id="character-buttons">
            <button class="choice-button" data-character="juan"><span>El Reto de Juan</span></button>
            <button class="choice-button" data-character="leo"><span>El Reto de Leo</span></button>
            <button class="choice-button" data-character="ana"><span>El Reto de Ana</span></button>
            <button class="choice-button" data-character="sofia"><span>El Reto de Sof√≠a</span></button>
        </div>
    </div>

    <main id="game-container" class="main-container hidden">
        <div class="image-block" id="game-image-block">
            <span class="circleLight"></span>
            <!-- Contenedor simplificado sin glitch pesado -->
            <div class="c-glitch" id="glitch-container"></div>
        </div>
        <h1 id="scene-title"></h1>
        <div id="story-text"></div>
        <div id="choices-container"></div>
    </main>

    <audio id="background-music" loop></audio>

    <script>
        /* === L√ìGICA ORIGINAL (sin cambios) === */
        const characterSelectionContainer = document.getElementById('character-selection-container');
        const characterButtons = document.querySelectorAll('#character-buttons .choice-button');
        const gameContainer = document.getElementById('game-container');
        const storyTextElement = document.getElementById('story-text');
        const choicesContainerElement = document.getElementById('choices-container');
        const sceneTitleElement = document.getElementById('scene-title');
        const audioElement = document.getElementById('background-music');
        
        // Variables del control de m√∫sica
        const musicControl = document.getElementById('music-control');
        const musicText = document.getElementById('music-text');
        
        const glitchContainer = document.getElementById('glitch-container');
        const glitchImages = glitchContainer.querySelectorAll('.c-glitch__img'); // ahora vac√≠o, pero no rompe
        const selectionGlitchContainer = document.getElementById('selection-glitch-container');
        const selectionGlitchImages = selectionGlitchContainer.querySelectorAll('.c-glitch__img');

        const mainTheme = 'audio/main_theme.mp3';
        const stories = {
            juan: {
                music: 'audio/juan_theme.mp3',
                scenes: [
                    { id: 1, title: "El Reto de Juan", text: "Son las 8:00 a.m. Tu examen final es a las 9:00 a.m. Sales de casa.", image: "juego_1_ponte_mis_zapatos/juan/img/1.webp", choices: [ { text: "Avanzar por el and√©n", nextSceneId: 2 } ] },
                    { id: 2, title: "Primera Barrera", text: "A solo una cuadra, un carro bloquea el and√©n. Es imposible pasar.", image: "juego_1_ponte_mis_zapatos/juan/img/2.webp", choices: [ { text: "Bajar a la calle para rodearlo", nextSceneId: 3 }, { text: "Esperar y pedir ayuda", nextSceneId: 4 } ] },
                    { id: 3, title: "Ruta Peligrosa", text: "Bajas a la calle. Los carros pasan r√°pido y te sientes vulnerable. Llegas al paradero, pero has perdido tiempo valioso.", image: "juego_1_ponte_mis_zapatos/juan/img/3.webp", choices: [ { text: "Esperar el bus", nextSceneId: 5 } ] },
                    { id: 5, title: "Bus Inaccesible", text: "Llega tu ruta, pero es un bus antiguo sin rampa. El conductor te ve y sigue de largo. La frustraci√≥n es enorme.", image: "juego_1_ponte_mis_zapatos/juan/img/4.webp", choices: [ { text: "Esperar el siguiente bus", nextSceneId: 6 } ] },
                    { id: 6, title: "Final Desastroso", text: "El siguiente bus tarda 20 minutos en llegar. Cuando por fin subes, ya es demasiado tarde. Has perdido el examen final.", image: "juego_1_ponte_mis_zapatos/juan/img/noc.webp", choices: [ { text: "Ver Reflexi√≥n", nextSceneId: 7 } ] },
                    { 
                        id: 7, title: "Reflexi√≥n: Exclusi√≥n", image: "juego_1_ponte_mis_zapatos/juan/img/exj.webp", 
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Juan</th></tr><tr><td><strong>Resultado:</strong><br>Fallaste en tu objetivo por barreras fuera de tu control.</td><td><strong>Causas:</strong><br>‚Ä¢ Infraestructura deficiente (andenes, buses).<br>‚Ä¢ Falta de empat√≠a y civismo.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>A veces, no importa cu√°nto te esfuerces, si el sistema no es inclusivo, te deja por fuera. La exclusi√≥n es el resultado de un entorno que no est√° dise√±ado para todos.</td></tr></table>`, 
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ] 
                    },
                    { id: 4, title: "Pidiendo Ayuda", text: "Decides esperar. La primera persona te ignora, pero insistes. Una segunda persona se detiene y te ayuda a pasar de forma segura.", image: "juego_1_ponte_mis_zapatos/juan/img/7.webp", choices: [ { text: "Agradecer y continuar", nextSceneId: 8 } ] },
                    { id: 8, title: "Un Aliado", text: "La persona que te ayud√≥ se indigna por el carro mal parqueado y decide reportarlo. Juntos llegan al paradero.", image: "juego_1_ponte_mis_zapatos/juan/img/alj.webp", choices: [ { text: "Esperar el bus en compa√±√≠a", nextSceneId: 9 } ] },
                    { id: 9, title: "Final Positivo", text: "El primer bus es inaccesible, pero el segundo, que llega r√°pido, s√≠ tiene rampa. Subes y llegas a tu examen justo a tiempo. La ayuda de una persona marc√≥ la diferencia.", image: "juego_1_ponte_mis_zapatos/juan/img/fnj.webp", choices: [ { text: "Ver Reflexi√≥n", nextSceneId: 10 } ] },
                    { 
                        id: 10, title: "Reflexi√≥n: El Poder de la Ayuda", image: "juego_1_ponte_mis_zapatos/juan/img/ayj.webp",
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Juan</th></tr><tr><td><strong>Resultado:</strong><br>Lograste tu objetivo a pesar de las dificultades.</td><td><strong>Clave del √âxito:</strong><br>‚Ä¢ Tu paciencia y perseverancia.<br>‚Ä¢ La empat√≠a y acci√≥n de otra persona.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>Las barreras sist√©micas son dif√≠ciles de superar en solitario. La empat√≠a y la disposici√≥n a ayudar de los dem√°s pueden ser el puente que garantiza la inclusi√≥n y la igualdad de oportunidades.</td></tr></table>`, 
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ]
                    }
                ]
            },
            leo: {
                music: 'audio/leo_theme.mp3',
                scenes: [
                    { id: 11, title: "El Reto de Leo", text: "Necesitas comprar tres ingredientes. Coges tu bast√≥n y sales de casa.", image: "juego_1_ponte_mis_zapatos/leo/1.webp", choices: [{ text: "Comenzar a caminar", nextSceneId: 12 }] },
                    { id: 12, title: "Primera Barrera", text: "Sigues la l√≠nea gu√≠a del and√©n, pero tu bast√≥n cae en un hueco. Es una alcantarilla abierta.", image: "juego_1_ponte_mis_zapatos/leo/2.webp", choices: [{ text: "Intentar rodearla por tu cuenta", nextSceneId: 13 }, { text: "Pedir orientaci√≥n", nextSceneId: 14 }] },
                    { id: 13, title: "Rodeando a Ciegas", text: "Te mueves hacia la pared para rodear el peligro, pero te golpeas con una se√±al de tr√°fico mal ubicada. Entras al supermercado frustrado.", image: "juego_1_ponte_mis_zapatos/leo/3.webp", choices: [{ text: "Buscar los productos solo", nextSceneId: 15 }] },
                    { id: 15, title: "Final Desastroso", text: "Intentas encontrar los productos al tacto. Despu√©s de mucho tiempo, llegas a la caja y el cajero te informa que has cogido lasa√±a y arvejas. Frustrado, decides irte sin nada.", image: "juego_1_ponte_mis_zapatos/leo/7.webp", choices: [{ text: "Ver Reflexi√≥n", nextSceneId: 16 }] },
                    { 
                        id: 16, title: "Reflexi√≥n: Falta de Apoyo", image: "juego_1_ponte_mis_zapatos/leo/8.webp",
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Leo</th></tr><tr><td><strong>Resultado:</strong><br>No lograste tu objetivo y te fuiste con las manos vac√≠as.</td><td><strong>Causas:</strong><br>‚Ä¢ Entorno f√≠sico peligroso e inaccesible.<br>‚Ä¢ Falta de sistemas de apoyo en el comercio.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>La falta de accesibilidad (etiquetas, personal capacitado) convierte una tarea simple en una misi√≥n imposible, generando dependencia y frustraci√≥n. La autonom√≠a se pierde.</td></tr></table>`, 
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ]
                    },
                    { id: 14, title: "Pidiendo Ayuda", text: "Te detienes y pides ayuda. Una persona amable te gu√≠a para pasar el obst√°culo de forma segura y te acompa√±a hasta la entrada del supermercado.", image: "juego_1_ponte_mis_zapatos/leo/9.webp", choices: [{ text: "Agradecer y entrar", nextSceneId: 17 }] },
                    { id: 17, title: "Asistencia Adecuada", text: "Dentro, le pides ayuda a un empleado. √âl amablemente te acompa√±a por los pasillos, te lee las etiquetas y te ayuda a encontrar exactamente lo que necesitabas.", image: "juego_1_ponte_mis_zapatos/leo/asl.webp", choices: [{ text: "Ir a la caja", nextSceneId: 18 }] },
                    { id: 18, title: "Final Positivo", text: "Con los productos correctos, pagas sin problemas y sales del supermercado habiendo completado tu tarea de forma eficiente y sinti√©ndote respetado.", image: "juego_1_ponte_mis_zapatos/leo/fpl.webp", choices: [{ text: "Ver Reflexi√≥n", nextSceneId: 19 }] },
                    { 
                        id: 19, title: "Reflexi√≥n: Inclusi√≥n Efectiva", image: "juego_1_ponte_mis_zapatos/leo/ril.webp",
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Leo</th></tr><tr><td><strong>Resultado:</strong><br>Completaste tu objetivo con √©xito y de forma aut√≥noma.</td><td><strong>Clave del √âxito:</strong><br>‚Ä¢ Pedir ayuda cuando fue necesario.<br>‚Ä¢ La existencia de personal capacitado y emp√°tico.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>La verdadera inclusi√≥n no es solo evitar barreras, sino tambi√©n proporcionar los apoyos adecuados. Una asistencia respetuosa fomenta la independencia y la dignidad.</td></tr></table>`,
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ]
                    }
                ]
            },
            ana: {
                music: 'audio/ana_theme.mp3',
                scenes: [
                    { id: 20, title: "El Reto de Ana", text: "Eres Ana, una persona sorda. Necesitas ir al banco para consultar sobre un cargo desconocido en tu cuenta.", image: "juego_1_ponte_mis_zapatos/ana/1.webp", choices: [ { text: "Entrar al banco", nextSceneId: 21 } ] },
                    { id: 21, title: "Llegando al mostrador", text: "Llegas al mostrador. El cajero te habla a trav√©s de un vidrio y no puedes leer sus labios. Le indicas que eres sorda.", image: "juego_1_ponte_mis_zapatos/ana/2.webp", choices: [ { text: "Usar l√°piz y papel", nextSceneId: 22 }, { text: "Usar una app de int√©rprete", nextSceneId: 23 } ] },
                    { id: 22, title: "Barreras de Comunicaci√≥n", text: "Sacas un cuaderno. La comunicaci√≥n es lenta y frustrante. La gente en la fila se impacienta. El cajero parece molesto.", image: "juego_1_ponte_mis_zapatos/ana/3.webp", choices: [ { text: "Intentar explicar el problema", nextSceneId: 24 } ] },
                    { id: 24, title: "Final Desastroso", text: "El cajero no entiende bien tu pregunta escrita, te da una respuesta gen√©rica y atiende a la siguiente persona. Te vas sin resolver tu problema y sinti√©ndote ignorada.", image: "juego_1_ponte_mis_zapatos/ana/4.webp", choices: [ { text: "Ver Reflexi√≥n", nextSceneId: 25 } ] },
                    { 
                        id: 25, title: "Reflexi√≥n: Comunicaci√≥n Rota", image: "juego_1_ponte_mis_zapatos/ana/5.webp",
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Ana</th></tr><tr><td><strong>Resultado:</strong><br>Tu problema no fue resuelto y la experiencia fue negativa.</td><td><strong>Causas:</strong><br>‚Ä¢ Falta de canales de comunicaci√≥n accesibles.<br>‚Ä¢ Impaciencia y falta de capacitaci√≥n del personal.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>La comunicaci√≥n es un derecho. Cuando las empresas no ofrecen alternativas accesibles (como int√©rpretes o video-llamadas), excluyen activamente a una parte de la poblaci√≥n.</td></tr></table>`, 
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ]
                    },
                    { id: 23, title: "Tecnolog√≠a como Aliada", text: "Sacas tu celular y abres una aplicaci√≥n de video-interpretaci√≥n que te conecta con un int√©rprete de Lengua de Se√±as.", image: "juego_1_ponte_mis_zapatos/ana/6.webp", choices: [ { text: "Mostrarle el tel√©fono al cajero", nextSceneId: 26 } ] },
                    { id: 26, title: "Comunicaci√≥n Fluida", text: "El cajero se sorprende, pero colabora. A trav√©s del int√©rprete en tu pantalla, tienes una conversaci√≥n clara y r√°pida. El cajero entiende tu problema al instante.", image: "juego_1_ponte_mis_zapatos/ana/7.webp", choices: [ { text: "Resolver el problema", nextSceneId: 27 } ] },
                    { id: 27, title: "Final Positivo", text: "El cajero identifica el cargo, lo corrige y te pide disculpas. Resuelves tu problema eficientemente y te vas sinti√©ndote satisfecha y empoderada.", image: "juego_1_ponte_mis_zapatos/ana/8.webp", choices: [ { text: "Ver Reflexi√≥n", nextSceneId: 28 } ] },
                    { 
                        id: 28, title: "Reflexi√≥n: Puentes Tecnol√≥gicos", image: "juego_1_ponte_mis_zapatos/ana/9.webp",
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Ana</th></tr><tr><td><strong>Resultado:</strong><br>Resolviste tu problema de forma r√°pida y aut√≥noma.</td><td><strong>Clave del √âxito:</strong><br>‚Ä¢ El uso de tecnolog√≠a de asistencia.<br>‚Ä¢ La disposici√≥n del personal para usar un m√©todo no tradicional.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>La tecnolog√≠a puede derribar barreras de comunicaci√≥n que antes parec√≠an insuperables. Las empresas que adoptan estas herramientas promueven una inclusi√≥n real y efectiva.</td></tr></table>`, 
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ]
                    }
                ]
            },
            sofia: {
                music: 'audio/sofia_theme.mp3',
                scenes: [
                    { id: 29, title: "El Reto de Sof√≠a", text: "Vives con ansiedad social. Tu reto: Ir a un centro comercial a reclamar una garant√≠a.", image: "juego_1_ponte_mis_zapatos/sofia/1.webp", choices: [ { text: "Ir al centro comercial", nextSceneId: 30 } ] },
                    { id: 30, title: "La Entrada", text: "Llegas a la entrada. El ruido, las luces y la multitud de gente te golpean de inmediato. Sientes que tu coraz√≥n se acelera.", image: "juego_1_ponte_mis_zapatos/sofia/2.webp", choices: [ { text: "Forzarte a entrar r√°pidamente", nextSceneId: 31 }, { text: "Tomarte un momento y usar tus aud√≠fonos", nextSceneId: 32 } ] },
                    { id: 31, title: "Sobrecarga Sensorial", text: "Entras de golpe. El caos sensorial es demasiado. Te sientes desorientada y abrumada, tu respiraci√≥n se agita.", image: "juego_1_ponte_mis_zapatos/sofia/3.webp", choices: [ { text: "Intentar buscar la tienda", nextSceneId: 33 } ] },
                    { id: 33, title: "Final Desastroso", text: "La sobrecarga se convierte en un ataque de p√°nico. No puedes pensar con claridad. La √∫nica opci√≥n es salir del centro comercial lo antes posible, sin lograr tu objetivo.", image: "juego_1_ponte_mis_zapatos/sofia/4.webp", choices: [ { text: "Ver Reflexi√≥n", nextSceneId: 34 } ] },
                    { 
                        id: 34, title: "Reflexi√≥n: Barreras Invisibles", image: "juego_1_ponte_mis_zapatos/sofia/5.webp",
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Sof√≠a</th></tr><tr><td><strong>Resultado:</strong><br>El entorno te super√≥ y no pudiste completar tu tarea.</td><td><strong>Causas:</strong><br>‚Ä¢ Sobrecarga sensorial (ruido, luces, multitud).<br>‚Ä¢ La naturaleza invisible de la discapacidad psicosocial.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>Para muchas personas, un entorno "normal" puede ser hostil. La accesibilidad tambi√©n significa crear espacios sensorialmente amables y tener empat√≠a por las luchas que no se ven.</td></tr></table>`, 
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ]
                    },
                    { id: 32, title: "Estrategia de Afrontamiento", text: "Te detienes un momento. Te pones los aud√≠fonos con m√∫sica tranquila y tomas varias respiraciones profundas. Entras sinti√©ndote m√°s preparada.", image: "juego_1_ponte_mis_zapatos/sofia/6.webp", choices: [ { text: "Buscar la tienda", nextSceneId: 35 } ] },
                    { id: 35, title: "Navegando el Entorno", text: "La m√∫sica te ayuda a bloquear el ruido excesivo. Logras encontrar la tienda y te pones en la fila, concentr√°ndote en tu respiraci√≥n.", image: "juego_1_ponte_mis_zapatos/sofia/7.webp", choices: [ { text: "Hablar con el empleado", nextSceneId: 36 } ] },
                    { id: 36, title: "Final Positivo", text: "Cuando llega tu turno, explicas la situaci√≥n con calma. El empleado es amable y procesa tu garant√≠a sin problemas. Sales del centro comercial sinti√©ndote orgullosa de haberlo logrado.", image: "juego_1_ponte_mis_zapatos/sofia/8.webp", choices: [ { text: "Ver Reflexi√≥n", nextSceneId: 37 } ] },
                    { 
                        id: 37, title: "Reflexi√≥n: Autogesti√≥n y Empat√≠a", image: "juego_1_ponte_mis_zapatos/sofia/9.webp",
                        text: `<table id="reflection-table"><tr><th colspan="2">An√°lisis del Reto de Sof√≠a</th></tr><tr><td><strong>Resultado:</strong><br>Completaste tu objetivo con √©xito.</td><td><strong>Clave del √âxito:</strong><br>‚Ä¢ El uso de estrategias de afrontamiento personalizadas.<br>‚Ä¢ Un momento de preparaci√≥n antes de enfrentar el desaf√≠o.</td></tr><tr><td colspan="2" class="ponte-en-tus-zapatos"><strong>Reflexi√≥n:</strong><br>Las personas con discapacidad psicosocial a menudo desarrollan herramientas para navegar el mundo. Respetar sus tiempos y procesos es una forma fundamental de empat√≠a y apoyo.</td></tr></table>`, 
                        choices: [ { text: "Elegir otro reto", nextSceneId: 'character_select' } ]
                    }
                ]
            }
        };

        let currentStoryData = null;

        function playMusic(track) {
            if (audioElement.src !== track) {
                audioElement.src = track;
            }
            audioElement.play().catch(error => console.log("La reproducci√≥n autom√°tica fue bloqueada por el navegador. Se requiere interacci√≥n del usuario."));
        }

        function showScene(sceneId) {
            if (sceneId === 'character_select') {
                gameContainer.classList.add('hidden');
                characterSelectionContainer.classList.remove('hidden');
                playMusic(mainTheme);
                return;
            }

            const scene = currentStoryData.scenes.find(s => s.id === sceneId);
            
            if (scene.text.includes("<table")) {
                storyTextElement.style.display = 'block';
                storyTextElement.style.minHeight = 'auto';
            } else {
                storyTextElement.style.display = 'flex';
                storyTextElement.style.minHeight = '100px';
            }
            const imageUrl = `url('${scene.image}')`;
            glitchContainer.style.backgroundImage = imageUrl;
            glitchImages.forEach(img => { img.style.backgroundImage = imageUrl; });
            sceneTitleElement.innerText = scene.title;
            storyTextElement.innerHTML = scene.text;
            choicesContainerElement.innerHTML = '';
            
            scene.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                const buttonText = document.createElement('span');
                buttonText.innerText = choice.text;
                button.appendChild(buttonText);
                
                if (choice.link) {
                    button.addEventListener('click', () => { window.location.href = choice.link; });
                } else {
                    button.addEventListener('click', () => showScene(choice.nextSceneId));
                }
                
                choicesContainerElement.appendChild(button);
            });
        }

        characterButtons.forEach(button => {
            button.addEventListener('click', () => {
                const character = button.dataset.character;
                currentStoryData = stories[character];
                characterSelectionContainer.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                playMusic(currentStoryData.music);
                showScene(currentStoryData.scenes[0].id);
            });
        });

        const selectionImageUrl = `url('imgs/00.webp')`;
        selectionGlitchContainer.style.backgroundImage = selectionImageUrl;
        selectionGlitchImages.forEach(img => {
            img.style.backgroundImage = selectionImageUrl;
        });
        
        playMusic(mainTheme);

        var mouse = { X: 0, Y: 0, CX: 0, CY: 0 },
            block = { X: mouse.X, Y: mouse.Y, CX: mouse.CX, CY: mouse.CY };

        $('.image-block').on('mousemove', function(e) {
            var $this = $(this);
            mouse.X = (e.pageX - $this.offset().left) - $this.width() / 2;
            mouse.Y = (e.pageY - $this.offset().top) - $this.height() / 2;
        });

        $('.image-block').on('mouseleave', function(e) {
            mouse.X = mouse.CX;
            mouse.Y = mouse.CY;
        });

        setInterval(function(){
            block.CY += (mouse.Y - block.CY) / 12;
            block.CX += (mouse.X - block.CX) / 12;

            $('.image-block .circleLight').css('background', 'radial-gradient(circle at ' + mouse.X + 'px ' + mouse.Y + 'px, #fff, transparent)');
            $('.image-block').css({
                transform: 'scale(1.03) translate(' + (block.CX * 0.05) + 'px, ' + (block.CY * 0.05) + 'px) rotateX(' + (block.CY * 0.05) + 'deg) rotateY(' + (block.CX * 0.05) + 'deg)'
            });
        }, 20);

        window.onload = function() {
            const preloader = document.getElementById('preloader');
            const body = document.querySelector('body');
            preloader.style.opacity = '0';
            setTimeout(() => {
                preloader.style.display = 'none';
                body.classList.remove('loading');
            }, 500);
        };
    </script>

    <script>
        // Ripple (no altera l√≥gica)
        document.addEventListener('click', e => {
            const btn = e.target.closest('.choice-button');
            if(!btn) return;
            const rect = btn.getBoundingClientRect();
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            ripple.style.left = (e.clientX - rect.left - 7) + 'px';
            ripple.style.top  = (e.clientY - rect.top - 7) + 'px';
            btn.appendChild(ripple);
            ripple.addEventListener('animationend', () => ripple.remove());
        }, { passive:true });

        // Control de m√∫sica
        musicControl.addEventListener('click', () => {
            if (audioElement.paused) {
                audioElement.play().catch(e => console.log("La reproducci√≥n de m√∫sica fue bloqueada."));
                musicText.innerHTML = "üîä Apagar M√∫sica";
            } else {
                audioElement.pause();
                musicText.innerHTML = "üîá Encender M√∫sica";
            }
        });

    </script>
</body>
</html>